詳しくはこちらのブログの記事を参考に。著作権はhosimituに帰属するかも。
http://www.hosimitu.com/2009/08/2923-1332.php

それぞれの機能の説明のために機能を小分けしています。
使う時はbase.phpとかにコピペでまとめて貰えればと思います。
質問等は上記のブログのコメントかtwitterでどうぞ。
http://twitter.com/hosimitu
回答できるかはわからないですが　:(；ﾞﾟ'ωﾟ'):

パーミッションの一例
phpは644 or 755
txtは606